<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yb.dao.EvaluationDao">
	<select id="queryTrend" resultType="Evaluation">
		select 
			<if test="date=='day'">
				DATE_FORMAT(date,'%Y-%m-%d')
			</if>
			<if test="date=='month'">
				DATE_FORMAT(date,'%Y-%m')
			</if>
			<if test="date=='year'">
				DATE_FORMAT(date,'%Y')
			</if> as date,((SUM(star5total)+SUM(star1total)+SUM(star2total)+SUM(star3total)+SUM(star4total))/sum(dealNumber))/5 star1
			 from res_vipEvaluation rve left join station on rve.stationID=station.id left join tag_station st
		
			on station.id=st.stationId left join tag on st.tagId=tag.id left join category on
			
			station.categoryId=category.id
			 where
			<if test="query=='station'">
				<if test="station!='all'">
					 rve.stationID=#{station} and
				</if>
			</if>
			<if test="query=='category'">
				 category.id=#{station} and
			</if>
			<if test="query=='tag'">
				 tag.id=#{station} and
			</if>date between DATE_FORMAT(#{start},'%Y-%m-%d') and DATE_FORMAT(#{end},'%Y-%m-%d')
			 
			 group by 1
	</select>
	<select id="queryDistribution" resultType="Evaluation">
		select SUM(star1total)/SUM(dealNumber) star1,SUM(star2total)/SUM(dealNumber) star2,SUM(star3total)/SUM(dealNumber) star3,
		SUM(star4total)/SUM(dealNumber) star4,SUM(star5total)/SUM(dealNumber) star5 from res_vipEvaluation rve left join station on rve.stationID=station.id left join tag_station st
		
			on station.id=st.stationId left join tag on st.tagId=tag.id left join category on
			
			station.categoryId=category.id
			 where
			<if test="query=='station'">
				<if test="station!='all'">
					 ro.stationId=#{station} and
				</if>
			</if>
			<if test="query=='category'">
				 category.id=#{station} and
			</if>
			<if test="query=='tag'">
				 tag.id=#{station} and
			</if>   date between DATE_FORMAT(#{start},'%Y-%m-%d') and DATE_FORMAT(#{end},'%Y-%m-%d')
	</select>
	<select id="queryEvaluations" resultType="Evaluation">
		select date,star1total/dealNumber star1,star2total/dealNumber star2,star3total/dealNumber star3,
		star4total/dealNumber star4,star5total/dealNumber star5 from res_vipEvaluation rve left join station on rve.stationID=station.id left join tag_station st
		
		on station.id=st.stationId left join tag on st.tagId=tag.id left join category on
			
			station.categoryId=category.id
			 where
			<if test="query=='station'">
				<if test="station!='all'">
					 ro.stationId=#{station} and
				</if>
			</if>
			<if test="query=='category'">
				 category.id=#{station} and
			</if>
			<if test="query=='tag'">
				 tag.id=#{station} and
			</if>   date between DATE_FORMAT(#{start},'%Y-%m-%d') and DATE_FORMAT(#{end},'%Y-%m-%d') group by 1
	</select>
</mapper>
